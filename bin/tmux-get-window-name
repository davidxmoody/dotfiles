#!/bin/bash

sed_cmd=sed
type gsed 2>/dev/null >/dev/null && sed_cmd=gsed

$sed_cmd "
  s%^/$%ROOT%;
  s%^$HOME$%HOME%;
  s%^$P_DIR/\\([^/]\\+\\)\\(/\\)\\?.*$%\\U\\1\\2%;
  s%^$HOME%~%;
  s%^\\(~\\)\\?/\\([^/]\\+\\)\\(/[^/]\\+\\)\\(/\\)\\?.*$%\\1/\\2\\3\\4%;
" <<< "${1:-$PWD}"
