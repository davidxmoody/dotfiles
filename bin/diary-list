#!/usr/bin/env bash

set -e

[[ ! -d "$DIARY_DIR" ]] && echo "DIARY_DIR does not exist" >&2 && exit 1

cd "$DIARY_DIR/entries"

terminal_width=$(tput cols)
preview_width=$((terminal_width - 33))

last_year=$(ls -r | head -n1)

selected=$(ag -g "" "$last_year" | sort -r | fzf --preview-window=right:$preview_width --preview 'fmt -s --width=$COLUMNS {}')

[[ ! -z "$selected" ]] && nvim "$selected"
