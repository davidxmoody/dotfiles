#!/usr/bin/env bash

set -e
shopt -s nullglob

file="${1}"
date="${2//-/\/}"

if [[ -z "$file" || -z "$date" || -z "$DIARY_DIR" ]]; then
  echo "usage: diary-import-scanned FILE DATE" >&2
  exit 1
fi

dir="$DIARY_DIR/scanned/$date"
mkdir -pv "$dir"

start_index=1
for f in $dir/scanned-??.*; do
  start_index=$((start_index+1))
done

extension="${file##*\.}"
if [[ "$extension" == "jpeg" ]]; then
  extension="jpg"
fi

mv -nv "$file" "$dir/scanned-$(printf "%02d" "$start_index").$extension"
