#!/usr/bin/env bash

set -e

[[ ! -d "$DIARY_DIR" ]] && echo "DIARY_DIR does not exist" >&2 && exit 1

cd "$DIARY_DIR/entries"

terminal_width=$(tput cols)
preview_width=$((terminal_width - 33))

files=$(ag -g "" | shuf -n40)
sorted_files=$(wc -w $files | head -n-1 | sort -nr | awk '{print $2}')

selected=$(echo "$sorted_files" | fzf --preview-window=right:$preview_width --preview 'fmt -s --width=$COLUMNS {}')

[[ ! -z "$selected" ]] && nvim "$selected"
