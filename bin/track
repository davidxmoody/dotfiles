#!/bin/bash

dir=$1
cmd=${2-status}

if [ ! -d "$dir" ]; then
  echo "Please enter a directory name"
  exit 1
fi

full_path=$(readlink -f "$dir")
no_leading_slash=${full_path#/}
dashes_for_slashes=${no_leading_slash//\//-}

git_dir="/tmp/${dashes_for_slashes}.git"

git_track() {
  git --git-dir="${git_dir}" --work-tree="${full_path}" "$@"
}

if [ ! -d "$git_dir" -o "$cmd" = "init" ]; then
  git_track init
  git_track add -A :/
  git_track commit -m "Automatic commit"
else
  case "$cmd" in
    commit)
      git_track add -A :/
      git_track commit -m "Automatic commit"
      ;;
    status)
      git_track status
      ;;
    diff)
      git_track diff
      ;;
    log|lg)
      git_track lg
      ;;
    *)
      echo "Command not recognised"
      exit 1
      ;;
  esac
fi
