#!/bin/bash
set -o errexit nounset
[ -z "$DIARY_DIR" ] && echo '$DIARY_DIR does not exist' && exit 1

# Import all text entries in android-entries/
cd "$DIARY_DIR"
for entry in android-entries/diary-*.txt; do
  [ ! -f "$entry" ] && continue
  [ ! -s "$entry" ] && echo "Empty file not copied: $DIARY_DIR/$entry" && continue
  [[ "$entry" == *conflict* ]] && echo "Dropbox conflicted file not copied: $DIARY_DIR/$entry" && continue
  timestamp=${entry#android-entries/diary-}
  timestamp=${timestamp%%-*.txt}
  month=$(date -d "@$timestamp" "+%Y-%m")

  touch "$entry"
  mkdir -p "entries/$month"
  mv -iv "$entry" "entries/$month/"
done
