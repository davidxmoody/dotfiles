#!/usr/bin/env bash

set -e

initial_dir=${1%/}

if [ ! -z "$initial_dir" -a -d "$P_DIR/$initial_dir" ]; then
  chosen_dir="$P_DIR/$initial_dir"
else
  chosen_dir=$(ls -1 "$P_DIR" | fzf --select-1 --query "$initial_dir" --preview "git --git-dir='$P_DIR/{}/.git' --work-tree='$P_DIR/{}' status -sb -uall")
fi

if [ ! -z "$chosen_dir" ]; then
  echo "$P_DIR/$chosen_dir"
  echo "$(date +%F)	$chosen_dir" >> ~/.choose-project-history
fi
